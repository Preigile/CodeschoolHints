# 1.1 Основы Ajax

## 1.2 Ajax

_Задание._
В Try JQuery, мы научились [плавно отображать](https://github.com/Preigile/CodeschoolHints/blob/master/JavaScript/Try_jQuery/4.events.md#44-%D0%AD%D1%84%D1%84%D0%B5%D0%BA%D1%82-%D1%81%D0%BB%D0%B0%D0%B9%D0%B4%D0%B0-i) некоторое содержимое после клика, но это было для демонстрации контента, который был уже загружен, но скрыт в HTML. Теперь мы отрефакторим этот код для извлечения и демонстрации содержимого с помощью Ajax.   
Для начала, отрефакторим код ниже, чтобы сделать запрос $.ajax для относительного URL /photos.html. 
application.js:
```javascript
$(document).ready(function () {
    $('#tour').on('click', 'button', function () {

    });
});
```
HTML:
```html
<div id="tour" data-location="london">
    <button>Get Photos</button>
    <ul class="photos">

    </ul>
</div>
```
```AJAX Result
<li>
    <img src="/assets/photos/paris1.jpg">
    <span style="display: none;">Arc de Triomphe</span>
</li>
<li>
    <img src="/assets/photos/paris2.jpg">
    <span style="display: none;">The Eiffel Tower</span>
</li>
<li>
    <img src="/assets/photos/london.jpg">
    <span style="display: none;">London</span>
</li>
```

_Решение._
В теле функции обратного вызова обработчика события click вызовем Ajax с относительным url путём в первом аргументе: 
```javascript
$(document).ready(function () {
    $('#tour').on('click', 'button', function () {
        $.ajax('/photos.html', {})
    });
});
```

_Пояснение._
AJAX (Asynchronous JavaScript And XML) - это техника на стороне клиента для общения с веб-сервером. Обычно браузер делает URL запрос на сервер, сервер возвращает ответ в виде html страницы (которая создаёт DOM) и, возможно, javascript. В случае с AJAX, JavaScrpt делает Ajax запрос на сервер, затем получает ответ, на основании которого преобразует DOM. Этот асинхронный HTTP (Ajax) запрос выполняет метод [jQuery.ajax()](http://api.jquery.com/jQuery.ajax/), где в качестве аргументов могут выступать url и наборы ответов сервера.

## 1.3 Ответ на Ajax

_Задание._
Теперь, когда запрос к серверу отправлен, нужно сделать что-то с ответом. Добавим коллбек обработчик success вызову $.ajax, который вставит содержимое ответа Ajax в html элемента .photos. 
После этого вызовем fadeIn() для этого элемента, чтобы он появился на экране.

_Решение._
Дополним второй аргумент в виде коллбек обработчика success, который будет отображать фото при успешно полученном ответе:
```javascript
$(document).ready(function () {
    $('#tour').on('click', 'button', function () {
        $.ajax('/photos.html', {
            success: function (response) {
                $('.photos').html(response).fadeIn();
            }})
    });
});
```

_Пояснение._
В jQuery success - это функция, которая вызывается, если запрос выполняется успешно. Может принимать 3 аргумента: данные, возвращаемые с сервера, формирующиеся в соответствии с параметром типа данных; строку, описывающую состояние; и jqXHR (в jQuery 1.4.x, XMLHttpRequest) объект. По состоянию на JQuery 1.5, success может принять массив функций. Каждая функция будет вызываться по-порядку. Это есть [событие Ajax](http://api.jquery.com/Ajax_Events/).   
Метод [html()](http://api.jquery.com/html/) позволяет получить HTML содержимое первого элемента в наборе соответствующих или установить HTML для каждого соответствующего элемента. В качестве аргумента может принимать html-строку, функцию или вообще ничего.  

## 1.4 Условное обозначение $.get

_Задание._
Есть лёгкий способ написать этот код с помощью условного обозначения метода JQuery $.get. сделаем рефакторинг кода, используя $.get вместо $.ajax. 

_Решение._
Заменим метод $.ajax на $.get, в котором не требуется употребление success:
```javascript
$(document).ready(function () {
    $('#tour').on('click', 'button', function () {
        $.get('/photos.html', function (response) {
            $('.photos').html(response).fadeIn();
        })
    });
});
```

_Пояснение._
С помощью метода [$.get()](http://api.jquery.com/jQuery.get/) можно загрузить данные из сервера, используя запрос HTTP GET. В качестве аргументов может содержать url; данные, которые отправляются как запрос на сервер; функцию обратного вызова, которая выполняется есле запрос успешен; указание на тип данных, ожидаемых от сервера (по умолчинию это xml, json, script, или html).

## 1.5 Данные Ajax

_Задание._
Используя опцию data функции $.ajax, передадим опцию location, чтобы получить фотографии london. пройти вариант местоположения. Извлечём location из data-location элемента #tour с помощью метода data.

_Решение._
Поместим опцию data в функцию $.ajax, а внутри неё - элемент данных london. Далее выберем данные location из элемента tour:
```javascript
$(document).ready(function () {
    $('#tour').on('click', 'button', function () {
        $.ajax('/photos.html', {
            data: {location: $('#tour').data('location')},
            success: function (response) {
                $('.photos').html(response).fadeIn();
            }
        })
    })
});
```

_Пояснение._
В $.ajax опция data содержит данные, которые будут отправлены на сервер. Они превращаются в строку запроса, если ещё не являются ею. Данные добавляются к url из GET-запросов. ProcessData может предотвратить эту автоматическую обработку. Объект должен иметь пару ключ/значение. Если значение является массивом, JQuery упорядочивает несколько значений с тем же ключом.
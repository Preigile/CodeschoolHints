# 5.1 События для плагинов

## 5.2 Удаление обработчиков событий

_Задание._
Был разработан прототип страницы, который извлекает контент со всего интернета и отображает его так, чтобы путешественники могли найти сведения о погоде и увидеть больше изображений для выбранного направления. В главе 6 мы сделаем этот контент динамичным, но сейчас захардкодим его.   
Проблема в том, что кнопка может быть нажата любое количество раз, и всегда будет добавляться погода. Обновим это, удалив оброботчик события при клике. Примечание: Можно воспользоваться $(this) для доступа к клику по кнопке.   
HTML:
```html
<ul>
    <li class="tour" data-loc="london" data-temp="48°">
        London, UK
        <button>More Info</button>
        <div class="results"></div>
    </li>

    <li class="tour" data-loc="paris1" data-temp="55°">
        Paris, France
        <button>More Info</button>
        <div class="results"></div>
    </li>

    <li class="tour" data-loc="newyork1" data-temp="62°">
        New York, NY, USA
        <button>More Info</button>
        <div class="results"></div>
    </li>
</ul>
```
application.js
```javascript
$(document).ready(function () {
    // Get Weather
    $('button').on('click', function () {
        var results = $(this).closest('li').find('.results');
        results.append('<p>Weather: 74&deg;</p>');
    });
});
```

_Решение._
Удалим событие click:
```javascript
$(document).ready(function () {
    // Get Weather
    $('button').on('click', function () {
        $(this).off('click');
        var results = $(this).closest('li').find('.results');
        results.append('<p>Weather: 74&deg;</p>');
    });
});
```

_Пояснение._
Метод [off()](http://api.jquery.com/off/) удаляет обработчик событий. В качестве аргумента может принимать событие, селектор, обработчик или вообще ничего.

## 5.3 Пространства имён обработчиков событий

_Задание._
Оказывается, другой разработчик добавил немного функциональности  к кнопке, теперь она отображает фото. Нужно сохранить оба обработчика события работающими отдельно друг от друга, но сейчас обработчик погоды будет удалять обработчик для фото при клике.   
Пространство имен обработчика события погоды поместим к пространству имен погоды и обновим при удалении, чтобы предотвратить это.
```javascript
$(document).ready(function () {
    // Get Weather
    $('button').on('click', function () {
        var results = $(this).closest('li').find('.results');
        results.append('<p>Weather: 74&deg;</p>');
        $(this).off('click');
    });

    // Show Photos
    $('button').on('click.photos', function () {
        var tour = $(this).closest('li');
        var results = tour.find('.results');
        results.append('<p><img src="/assets/photos/' + tour.data('loc') + '.jpg" /></p>');
        $(this).off('click.photos');
    });
});
```

_Решение._
К существующему событию клика добавим пространство имени weather:
```javascript
$(document).ready(function () {
    // Get Weather
    $('button').on('click.weather', function () {
        var results = $(this).closest('li').find('.results');
        results.append('<p>Weather: 74&deg;</p>');
        $(this).off('click.weather');
    });

    // Show Photos
    $('button').on('click.photos', function () {
        var tour = $(this).closest('li');
        var results = tour.find('.results');
        results.append('<p><img src="/assets/photos/' + tour.data('loc') + '.jpg" /></p>');
        $(this).off('click.photos');
    });
});
```

_Пояснение._
При добавлении к собитию пространства имени, оно срабатывает только для него.

## 5.4 Триггер

_Задание._
При тестировании кода мы дожидаемся обновления страницы и кликаем по кнопке. Сделаем эти вещи немного проще с помощью trigger клика по кнопеке, когда страница загржается.

_Решение._
Добавим триггер для клика по всем кнопкам:
```javascript
$(document).ready(function () {
    // Get Weather
    $('button').on('click.weather', function () {
        var results = $(this).closest('li').find('.results');
        results.append('<p>Weather: 74&deg;</p>');
        $(this).off('click.weather');
    });

    // Show Photos
    $('button').on('click.photos', function () {
        var tour = $(this).closest('li');
        var results = tour.find('.results');
        results.append('<p><img src="/assets/photos/' + tour.data('loc') + '.jpg" /></p>');
        $(this).off('click.photos');
    });

    $('botton').trigger('click');
});
```

_Пояснение._
Метод trigger() выполняет все обработчики и поведения, прикрепленные к соответствующим элементам для данного типа событий.

## 5.5 Пользовательские события

_Задание._
Что, если мы хотим загрузить их в определённом порядке? По умолчанию, jQuery загружает в парядке объявления, но мы также можем контролировать этот порядок проинициировав одно событие из другого.   
Изменим событие click.weather для нового пользовательского события, чтобы оно больше не прослушивало клик. Сделаем триггер этого события изнутри обработчика click.photos.

_Решение._
Изменим название события в пространстве имени weather на пользовательское show в обработчике и в off. В теле коллбека с обработчиком собитий пространства имени photo добавим триггер с show.weather: 
```javascript
$(document).ready(function () {
    // Get Weather
    $('button').on('show.weather', function () {
        var results = $(this).closest('li').find('.results');
        results.append('<p>Weather: 74&deg;</p>');
        $(this).off('show.weather');
    });


    // Show Photos
    $('button').on('click.photo', function () {
        var tour = $(this).closest('li');
        var results = tour.find('.results');
        results.append('<p><img src="/assets/photos/' + tour.data('loc') + '.jpg" /></p>');
        $(this).off('click.photos');
        $(this).trigger('show.weather');
    });
});
```

_Пояснение._
Мы можем создать свои собственные события и использовать их для нескольких DOM.
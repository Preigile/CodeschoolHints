# 4.1 Модели и данные Ember

## 4.2 Модель Product

_Задание._
До настоящего момента все наши продукты были захардкожены в массиве PRODUCTS. Преобразуем его объекты в Ember Model, используя Ember Data.   
1) Создать новую модель для Product.   
2) Создать атрибуты в Product для каждого из тех, что использовались в массиве App.PRODUCTS.   
3) Настроить Ember Application для использования Ember Data FixtureAdapter.   
4) Переименовать переменную App.PRODUCTS variable для обеспечения закреплёнными данными. Убедиться, что они определяются после модели, которая была обеспечена закреплёнными данными.    
5) Каждому продукту нужен уникальный идентификатор для Ember Data. Добавить его.   
6) Изменить динамический сегмент для пути product, используя идентификатор, который ожидает Ember Data.   
7) При посещении пути products, Route всё ещё выглядит в старом закреплении. Обновить поиск всех продуктов, используя Ember Data.   
8) Путь product всё ещё ищет модели тоже используя старые закрепления! Обновить его для работы с повой настройкой либо изменив модель, либо используя по умолчанию.  

_Решение._
В этот раз вся работа будет проходить в файле app.js. Здесь нужно создать расширение DS.Model для Product. В этом расширение дать свойствам, соответствующим свойствам объектов с товарами, значение DS.attr() с типом передаваемых данных. В расширении Ember.Route для Product и Products немного изменим метод model так, чтобы он отыскивал сохранённые продукты. Не забудем для массива с продуктами использовать FIXTURES и добавить правильное id каждому из объектов. А затем добавим расширение DS.FixtureAdapter для всего приложения. Путь теперь не реботает, так что заменим его на product_id:
```javascript
var App = Ember.Application.create({
    LOG_TRANSITIONS: true
});

App.Router.map(function () {
    this.route('credits', { path: '/thanks' });
    this.resource('products', function () {
        this.resource('product', { path: '/:product_id' });
    });
    this.resource('contacts', function () {
        this.resource('contact', { path: '/:name' });
    });
});

App.Product = DS.Model.extend({
    title: DS.attr('string'),
    price: DS.attr('number'),
    description: DS.attr('string'),
    isOnSale: DS.attr('boolan'),
    image: DS.attr('string')
});

App.IndexController = Ember.Controller.extend({
    productsCount: 6,
    logo: 'images/logo-small.png',
    time: function () {
        return (new Date()).toDateString();
    }.property()
});

App.ContactsIndexController = Ember.Controller.extend({
    contactName: 'Anostagia',
    avatar: 'images/avatar.png',
    open: function () {
        return ((new Date()).getDay() === 0) ? "Closed" : "Open";
    }.property()
});

App.ProductsRoute = Ember.Route.extend({
    model: function () {
        return this.store.findAll('product');
    }
});

App.ProductRoute = Ember.Route.extend({
    model: function (params) {
        return this.store.find('product', params.product_id);
    }
});

App.ContactsRoute = Ember.Route.extend({
    model: function () {
        return App.CONTACTS;
    }
});

App.ContactRoute = Ember.Route.extend({
    model: function (params) {
        return App.CONTACTS.findBy('name', params.name);
    }
});

App.Product.FIXTURES = [
    {
        id: 1,
        title: 'Flint',
        price: 99,
        description: 'Flint is a hard, sedimentary cryptocrystalline form of the mineral quartz, categorized as a variety of chert.',
        isOnSale: true,
        image: 'images/products/flint.png'
    },
    {
        id: 2,
        title: 'Kindling',
        price: 249,
        description: 'Easily combustible small sticks or twigs used for starting a fire.',
        isOnSale: false,
        image: 'images/products/kindling.png'
    }
];

App.CONTACTS = [
    {
        name: 'Giamia',
        about: 'Although Giamia came from a humble spark of lightning, he quickly grew to be a great craftsman, providing all the warming instruments needed by those close to him.',
        avatar: 'images/contacts/giamia.png'
    },
    {
        name: 'Anostagia',
        about: 'Knowing there was a need for it, Anostagia drew on her experience and spearheaded the Flint & Flame storefront. In addition to coding the site, she also creates a few products available in the store.',
        avatar: 'images/contacts/anostagia.png'
    }
];

App.ApplicationAdapter = DS.FixtureAdapter.extend();
```

_Пояснение._
Чаще всего данные выбираются не из массива, а из сервера. Для того, чтобы осуществить такую выборку используют расширение DS.Model. Модель предоставляет все данные, которые увидет пользователь. Каждый Route может иметь модель. Модель Ember должна знать какие атрибуты она содержит, поэтому каждому свойству внутри объекта-аргумента расширения предосталляется значение DS.attr() с типом данных. Если этот тип не известен, то скобки остаются пустыми, в противном случае в них помещается строковое обозначение типа.    

## 4.3 Модель Contact

_Задание._
Пока мы думаем об Ember Data, преобразуем также наш массив CONTACTS.   
1) Создать новую модель для Contact.   
2) Создать атрибуты в Contact для каждого из тех, что использовались в массиве App.CONTACTS.   
3) Переименовать переменную App.CONTACTS variable для обеспечения закреплёнными данными. Убедиться, что они определяются после модели, которая была обеспечена закреплёнными данными.    
4) Добавить уникальный идентификатор для каждого Contact.
5) Изменить динамический сегмент для пути contact, используя идентификатор, который ожидает Ember Data.   
6) При посещении пути contacts, Route всё ещё выглядит в старом закреплении. Обновить поиск всех контактов, используя Ember Data.   
8) Путь contact всё ещё ищет модели тоже используя старые закрепления! Обновить его для работы с повой настройкой либо изменив модель, либо используя по умолчанию.   

_Решение._
Проделаем те же шаги, что и в прошлый раз для контактов, только не будем добавлять расширение DS.FixtureAdapter, оно распространяется на все модели:
```javascrit
App.ContactsRoute = Ember.Route.extend({
    model: function () {
        return this.store.findAll('contact');
    }
});

App.ContactRoute = Ember.Route.extend({
    model: function (params) {
        return this.store.find('product', params.contact_id);
    }
});

App.Contact = DS.Model.extend({
    name: DS.attr('string'),
    about: DS.attr('string'),
    avatar: DS.attr('string')
});

App.Contact.FIXTURES = [
    {
        id: 1,
        name: 'Giamia',
        about: 'Although Giamia came from a humble spark of lightning, he quickly grew to be a great craftsman, providing all the warming instruments needed by those close to him.',
        avatar: 'images/contacts/giamia.png'
    },
    {
        id: 2,
        name: 'Anostagia',
        about: 'Knowing there was a need for it, Anostagia drew on her experience and spearheaded the Flint & Flame storefront. In addition to coding the site, she also creates a few products available in the store.',
        avatar: 'images/contacts/anostagia.png'
    }
];

App.ApplicationAdapter = DS.FixtureAdapter.extend();
```

_Пояснение._
Ember Data позволяет легко использовать модель для извлечения записей с сервера, кэшировать их производительности, сохранять обновления обратно на сервер, и создавать новые записи на клиенте. `App.ApplicationAdapter = DS.FixtureAdapter.extend();` жёстко фиксирует наши данные перед началом работы. При таком фиксировании к массиву с данными добавляется .FIXTURES. Теперь, чтобы получить данные, нужно использовать this.store.findAll() (для всех элементов) или this.store.find() (для конкретного элемента).
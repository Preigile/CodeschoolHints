# 3.1 Маршруты ресурсов

## 3.2 Маршрут Products

_Задание._
Пришло время построить магазин!   
1) Создать путь resource для новой страницы products.   
2) Создать ссылку на products route в navigation bar в таком же стиле, что и другие ссылки.    
3) Нам нужны продукты для отображения на новой странице. Создадим массив продуктов в App.PRODUCTS, который содержит минимум 2 продукта. Они будут базироваться на объектах JavaScript со свойствами title, price, description, isOnSale и image. Для свойства image можно использовать два изображения: images/products/flint.png and images/products/kindling.png.   
4) Для того, чтобы увидить эти продукты, нужно создать ещё один объект, который будет передавать массив продуктов в качестве модели.   
5) Для отображения продуктов всё готово! Создать шаблон для страницы products, а в нём пройтись циклом по каждому из продуктов. Вывести их название и изображение.    
index.html: 
```html
<!DOCTYPE html>
<html>
<head>
    <base href='http://courseware.codeschool.com/ember/'/>
    <link href='bootstrap.css' rel='stylesheet'/>
    <link href='application.css' rel='stylesheet'/>
    <script src='jquery.js'></script>
    <script src='handlebars.js'></script>
    <script src='ember.js'></script>
    <script src='ember-data.js'></script>
    <script src='app.js'></script>
</head>
<body>
<script type='text/x-handlebars' data-template-name='application'>
    <div class='navbar navbar-default'>
        <div class='container'>
            {{#link-to 'index' class='navbar-brand'}}<img src='images/logo.png' alt='logo' height='34' width='224'/>{{/link-to}}
            <ul class='nav navbar-nav navbar-right'>
                {{#link-to 'index' tagName='li'}}Home{{/link-to}}
                {{#link-to 'about' tagName='li'}}About{{/link-to}}
            </ul>
        </div>
    </div>
    <div class='container'>
        {{outlet}}
    </div>
    <footer class='container'>
        <hr/>
        <p class='pull-left'>&copy; 2013 The Flint &amp; Flame</p>

        <p class='pull-right'>{{#link-to 'credits'}}Credits{{/link-to}}</p>
    </footer>
</script>
<script type='text/x-handlebars' data-template-name='index'>
    <div class='jumbotron'>
        <h1>Welcome to The Flint &amp; Flame!</h1>

        <p class='tagline'>
            <img {{bind-attr src='logo'}} alt='Logo' />
            Everything you need to make it through the winter.
        </p>

        <p>Browse All {{productCount}} Items &raquo;</p>
    </div>
    <p class='pull-right text-muted'>Rendered on {{time}}</p>
</script>
<script type='text/x-handlebars' data-template-name='about'>
    <div class='row'>
        <img {{bind-attr src='avatar'}} alt='Avatar' class='img-thumbnail col-sm-4'/>
        <div class='col-sm-8'>
            <h1>About The Fire Sprites</h1>

            <p>Contact {{contactName}} for more info!</p>

            <p>Current Status: {{open}}.</p>
        </div>
    </div>
</script>
<script type='text/x-handlebars' data-template-name='credits'>
    <h1>Thanks for the Help!</h1>

    <p>This site would not be possible without the hardworking Ember Core Team!</p>
</script>
</body>
</html>
```
app.js:
```javascript
var App = Ember.Application.create({
    LOG_TRANSITIONS: true
});
App.Router.map(function () {
    this.route('credits', { path: '/thanks' });
    this.route('about');
});
App.IndexController = Ember.Controller.extend({
    productsCount: 6,
    logo: 'images/logo-small.png',
    time: function () {
        return (new Date()).toDateString();
    }.property()
});
App.AboutController = Ember.Controller.extend({
    contactName: 'Anostagia',
    avatar: 'images/avatar.png',
    open: function () {
        return ((new Date()).getDay() === 0) ? 'Closed' : 'Open';
    }.property()
});
```

_Решение._
В файле app.js добавим к маршрутизатору метод resource с аргументом 'products'. Далее создадим массив PRODUCTS с двумя объектами, содержащими требуемые свойства, а затем, в расширении Route, вернём этот массив в качестве model. В HTML добавим на главную страницу ссылку Products, а перед закрывающим `</body>` - скрипт с именем шаблона products. В этом шаблоне пройдёмся по всем элементам созданного ранее массива и выберем из каждого объекта свойства image и title:    
app.js:
```javascript
App.Router.map(function () {
    this.route('credits', { path: '/thanks' });
    this.route('about');
    this.resource('products');
});
App.ProductsRoute = Ember.Route.extend({
    model: function () {
        return App.PRODUCTS;
    }
});
App.PRODUCTS = [
    {
        title: 'Flint',
        priсe: 99,
        description: 'Flint is...',
        isOnSale: true,
        image: 'images/products/flint.png'
    },
    {
        title: 'Kindling',
        priсe: 249,
        description: 'Easily...',
        isOnSale: false,
        image: 'images/products/kindling.png'
    }
];
```
index.html:
```html
<!DOCTYPE html>
<html>
<head>
    ...
</head>
<body>
<script type='text/x-handlebars' data-template-name='application'>
    <div class='navbar navbar-default'>
        <div class='container'>
            {{#link-to 'index' class='navbar-brand'}}<img src='images/logo.png' alt='logo' height='34' width='224'/>{{/link-to}}
            <ul class='nav navbar-nav navbar-right'>
                {{#link-to 'index' tagName='li'}}Home{{/link-to}}
                {{#link-to 'about' tagName='li'}}About{{/link-to}}
                {{#link-to 'products' tagName='li'}}Products{{/link-to}}
            </ul>
        </div>
    </div>
    ...
</script>
...
<script type='text/x-handlebars' data-template-name='products'>
    <h1>Products</h1>
    <ul class='list-unstyled'>
        {{#each}}
        <li class='row'>
            <img {{bind-attr src='image'}} class='img-thumbnail col-sm-5'/>
            <div class='col-sm-7'>
                <h2>{{title}}</h2>
            </div>
        </li>
        {{/each}}
    </ul>
</script>
</body>
</html>
```

_Пояснение._
Ключевое слово resource имеет некоторые дополнительные функциональные возможности. Оно может объединять группу route. А в целом, работа с ними происходит практически одинаково.    

## 3.3 Путь Contacts 

_Задание._
Наша страница About не достаточна хороша, чтобы удовлетворить любопытство по отношению к владельцам сайта. Они на самом деле Fire Sprites? Не плохо бы создать страницу Contacts, которая будит выводить список всех Fire Sprites.   
1) Создать путь resource для новой страницы contacts.   
2) Создать ссылку на contacts route в navigation bar в таком же стиле, что и другие ссылки.    
3) Нам нужно несколько контактов для отображения на новой странице. Создадим массив продуктов в App.CONTACTS, который содержит минимум 2 продукта. Они будут базироваться на объектах JavaScript со свойствами name, avatar, about. Можно использовать 2 изображения для свойства avatar: images/contacts/giamia.png и images/contacts/anostagia.png.   
4) Создать объект Route, который будт возвращать контакты, для использования в шаблоне.   
5) Создать шаблон для страницы contacts. В нём пройтись циклом по каждому из контактов и вывести свойства name, about и avatar.  

_Решение._
Проделаем всё то же самое, что и в прошлом упражнении, только теперь для contacts:
app.js:
```javascript
App.Router.map(function () {
    this.route('credits', { path: '/thanks' });
    this.route('about');
    this.resource('products');
    this.resource('contacts');
});

App.ContactsRoute = Ember.Route.extend({
    model: function () {
        return App.CONTACTS;
    }
});
App.CONTACTS = [
    {
        name: 'Irina',
        avatar: 'images/contacts/giamia.png',
        about: 'Front-end'
    },
    {
        name: 'Anatoly',
        avatar: 'images/contacts/anostagia.png',
        about: 'Back-end'
    }
];
```
index.html:
```html
<!DOCTYPE html>
<html>
<head>
    ...
</head>
<body>
<script type='text/x-handlebars' data-template-name='application'>
    <div class='navbar navbar-default'>
        <div class='container'>
            {{#link-to 'index' class='navbar-brand'}}<img src='images/logo.png' alt='logo' height='34' width='224'/>{{/link-to}}
            <ul class='nav navbar-nav navbar-right'>
                {{#link-to 'index' tagName='li'}}Home{{/link-to}}
                {{#link-to 'about' tagName='li'}}About{{/link-to}}
                {{#link-to 'products' tagName='li'}}Products{{/link-to}}
                {{#link-to 'contacts' tagName='li'}}Contacts{{/link-to}}
            </ul>
        </div>
    </div>
    ...
</script>
...
<script type='text/x-handlebars' data-template-name='contacts'>
    <ul class='list-unstyled'>
        {{#each}}
        <li class='row'>
            <img {{bind-attr src='avatar'}} />
            <div>
                <p>{{name}}</p>

                <p>{{about}}</p>
            </div>
        </li>
        {{/each}}
    </ul>
</script>
</body>
</html>
```
   
_Пояснение._
В Ember мы же знакомились с [добавлением пути](https://github.com/Preigile/CodeschoolHints/blob/master/JavaScript/Warming_Up_with_Ember_js/1.warming_up.md#16-%D0%94%D0%BE%D0%B1%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BF%D1%83%D1%82%D0%B8) с помощью App.Router.map(), но кроме Router Ember имеет расширение Route (App.ProductsRoute = Ember.Route.extend({})). Оно выбирает данные и передает их в Ember Controller, решает, какую модель использовать для текущего маршрута и какой шаблон визуализировать на экране. Так Ember Router переводит путь в маршрут, Ember Route предоставляет данные для контроллера; Router используется для определения маршрутов, которые принимает приложение, Route несёт ответственность за получение данных из внешних ресурсов, а Controller украшает модель, обеспечивая значениями свойств. Другими словами, Route отвечает за выборку модели, Ember устанавливает эту модель на Controller, и то, что получится будет использоваться в Handlebars Template.
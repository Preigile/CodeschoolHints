# 5.1 Контроль роста

## 5.2 Сортировка и свойства для Products

_Задание._
Продукты на странице выглядят немного запутанно и необоснованно захардкоженны данные, которые должны гибко изменяться.   
1) Создать контроллер для пути products. Мы будем использовать его для сортировки продуктов на странице, так что использовать правильный тип контроллера.  
2) Отсортировать продукты по заголовку.   
3) Создать объект пути для homepage.   
4) Добавить функцию model для пути homepage, которая будет возвращать все продукты.    
5) Изменить IndexController для ArrayController.   
6) Обновить свойство productsCount в IndexController используя вычисляемые свойства.  

_Решение._
В файле app.js создадим контроллер для Products с помощью расширения Ember.ArrayController и отсортируем в нём товары по свойству title в алфавитном порядке. Контроллер Index также заменим на ArrayController, а свойству productsCount дадим значение не конкретного числа, а функции, подсчитывающей длинну массива. Кроме того, создадим расширение Route для Index, а в нём метод model, который отыскивает все продукты:   
```javascript
App.IndexController = Ember.ArrayController.extend({
    productsCount: function () {
        return this.get('length');
    }.property('length'),
    logo: 'images/logo-small.png',
    time: function () {
        return (new Date()).toDateString();
    }.property()
});

App.ProductsController = Ember.ArrayController.extend({
    sortProperties: ['title']
});

App.IndexRoute = Ember.Route.extend({
    model: function () {
        return this.store.findAll('product');
    }
});

App.Product.FIXTURES = [
    {  id: 1,
        title: 'Flint',
        price: 99,
        description: 'Flint is a hard, sedimentary cryptocrystalline form of the mineral quartz, categorized as a variety of chert.',
        isOnSale: true,
        image: 'images/products/flint.png',
        reviews: [100, 101],
        crafter: 200
    },
    {
        id: 2,
        title: 'Kindling',
        price: 249,
        description: 'Easily combustible small sticks or twigs used for starting a fire.',
        isOnSale: false,
        image: 'images/products/kindling.png',
        reviews: [],
        crafter: 201
    },
    {
        id: 3,
        title: 'Matches',
        price: 499,
        description: 'One end is coated with a material that can be ignited by frictional heat generated by striking the match against a suitable surface.',
        isOnSale: true,
        reviews: [103],
        image: 'images/products/matches.png',
        crafter: 201
    },
    {
        id: 4,
        title: 'Bow Drill',
        price: 999,
        description: 'The bow drill is an ancient tool. While it was usually used to make fire, it was also used for primitive woodworking and dentistry.',
        isOnSale: false,
        reviews: [104],
        image: 'images/products/bow-drill.png',
        crafter: 200
    },
    {
        id: 5,
        title: 'Tinder',
        price: 499,
        description: 'Tinder is easily combustible material used to ignite fires by rudimentary methods.',
        isOnSale: true,
        reviews: [],
        image: 'images/products/tinder.png',
        crafter: 201
    },
    {
        id: 6,
        title: 'Birch Bark Shaving',
        price: 999,
        description: 'Fresh and easily combustable',
        isOnSale: true,
        reviews: [],
        image: 'images/products/birch.png',
        crafter: 200
    }
];
```

_Пояснение._
В беспорядочном списке легко запутаться, поэтому его нужно отсортировывать. С этой задачей справляется свойство контроллера sortProperties. Оно отсортировывает требуемые данные в алфавитном порядке. Но для этого нам нужен специальный контроллер, который знает, что он будет иметь дело с массивом. Таким контроллером является Ember.ArrayController.    
Если нам нужно гибко изменять количество чего-либо на странице, к примеру продуктов, для начала установим соответствующую модель. Затем изменим тип контроллера на ArrayController,чтобы он мог подсчитывать элементы массива. И, в конце концов, передадим метод, который возвращает длину массива (this.get('length')).

## 5.3 Сортировка и свойства для Contacts

_Задание._
Используя наши новые знания о контроллерах, приведём в порядок страницу Contacts.   
1) Создать контроллер для пути contacts. Мы будем использовать его для сортировки контактов на странице.  
2) Отсортировать контакты по имени.   
3) Мы хардкодим "Anostagia" в контроллере ContactsIndex, но мы можем вернуть имя из модели. Создав объект пути обеспечить модель им.      
4) Обеспечить модель для ContactsIndex Route, которторая будет обеспечиваться только одной моделью - контактом для Anostagia. Его можно найти по ID.    
5) Теперь ContactsIndexController опирается тлько на один объект. Обновить тип контроллера для отображения контента позади него.   
6) Обновить свойство contactName используя иное вычисление на Ember.  

_Решение._
Создадим контроллер для массива контактов, в котором отсортируем свойства name по алфавиту. Создадим расширение Route для ContactsIndex, где в контактах отыщем тот, у которого id 201. Далее изменим тип контроллера ContactsIndex, а его свойству contactName дадим значение Ember.computed.alias, передав в него свойство name:
```javascript
App.ContactsIndexController = Ember.ObjectController.extend({
    contactName: Ember.computed.alias('name'),
    avatar: 'images/avatar.png',
    open: function () {
        return ((new Date()).getDay() === 0) ? "Closed" : "Open";
    }.property()
});

App.ContactsController = Ember.ArrayController.extend({
    sortProperties: ['name']
});

App.ContactsIndexRoute = Ember.Route.extend({
    model: function () {
        return this.store.find('contact', 201);
    }
});

App.Contact.FIXTURES = [
    {
        id: 200,
        name: 'Giamia',
        about: 'Although Giamia came from a humble spark of lightning, he quickly grew to be a great craftsman, providing all the warming instruments needed by those close to him.',
        avatar: 'images/contacts/giamia.png',
        products: [1]
    },
    {
        id: 201,
        name: 'Anostagia',
        about: 'Knowing there was a need for it, Anostagia drew on her experience and spearheaded the Flint & Flame storefront. In addition to coding the site, she also creates a few products available in the store.',
        avatar: 'images/contacts/anostagia.png',
        products: [2]
    }
];
```

_Пояснение._
Контроллеры могут быть не только для массивов, но и для объектов (Ember.ObjectController). Второй вид используется, когда мы работаем со свойствами одного объекта. В наших упражнениях мы сортировали свойства по алфавиту. Если нам нужен обратный алфавитный порядок, установим sortAscending в  false. Стоит также отметить, что в предыдущем упражнении, в свойстве productsCount для нахождения длины массива мы могли бы использовать Ember.computed.alias(), передав ему length. Оба эти варианта равнозначны. 